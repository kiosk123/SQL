# 시퀀스
오라클과 SQL Server는 일련번호를 관리하는 시퀀스 객체를 지원한다.  
시퀀스는 객체를 초기화해 놓기만 하면 요청할 때마다 증가한 값을 자동으로 돌려준다. 다음 명령으로 생성하며,  
몇가지 옵션이 있지만 대부분 디폴트를 취하면 된다.  
```sql
CREATE SEQUENCE 이름 [AS 타입] START WITH 시작값 INCREMENT BY 증가값
MINVALUE 최소값 MAXVALUE 최대값 CYCLE | NOCYCLE CACHE | NOCACHE
```
최소 최대값의 디폴트는 타입의 표현 범위 만큼 이고 CYCLE 옵션을 주면 이범위를 순환한다.  
CACHE 옵션은 성능 향상을 위해 현재값을 메모리에 저장하는데 디폴트로 선택되어 있다.  
  
증가값은 디폴트가 1이지만 시작값의 디폴트는 조금 다르다. 오라클은 1부터 시작하지만 SQL Server는 범위의  
첫 값인 음수에서 시작한다. 그래서 디비에 상관없이 1부터 시작하려면 `START WITH` 옵션을 활용한다.  
```sql
CREATE SEQUENCE SEQSALE START WITH 1 INCREMENT BY 1;
```
오라클일 경우 시퀀스 사용법은 다음과 같다.
```SQL
INSERT INTO TSALE VALUES (SEQSALE.NEXTVAL, '단군', '지팡이');
```

## 자동 생성 시퀀스 - 오라클만 지원
시퀀스는 특정 테이블의 필드를 위해 생성하며 공유하는 경우가 별로 없다.  
그러므로 따로 시퀀스 객체를 만드는 것보다 테이블을 만들 때 아예 시쿼스 필드로 시정하는 것이 효율적이다.  
필드 선언문에 다음 속성을 지정하면 시퀀스 필드가 된다.
```SQL
GENERATED [ALWAYS | BY DEFAULT | BY DEFAULT ON NULL] AS IDENTITY
[START WITH 시작값 INCREMENT BY 증가값 CACHE]

--(EX)
CREATE TABLE TSALESEQ
(
    SALENO INT GENERATED AS IDENTITY PRIMARY KEY,
    CUSTOMER VARCHAR(20),
    PRODUCT VARCHAR(30)
)
```
내부적으로 시퀀스를 **자동 생성하며 따라서 시퀀스 생성 권한이 있어야한다**.  
  
삽입할 때는 SALENO를 생략하고 나머지 필드만 지정한다.
```SQL
INSERT INTO TSALESEQ(CUSTOMER,PRODUCT) VALUES('단군', '지팡이');
```

시퀀스로 지정된 필드에 값을 직접 주게 되면 에러가 발생하지만 다음과 같이 옵션으로 ID열을 정의하면 직접 입력이 가능하다.
```SQL
-- ID값 직접 입력가능
SALENO INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

-- ID값이 없을때 시퀀스가 알아서 값을 증분해서 집어 넣음 
SALENO INT GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
```